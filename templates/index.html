{% extends 'base.html' %}
{% load i18n %}
{% block title %}Home{% endblock %}
{% block content %}
<div class="row">
    <div class="col-md-8">
    {% block request_list %}
    {% endblock %}
    </div>
    <div class="col-md-4">
        {% include "partials/telescope_availability_chart.html" %}
        {% if user.is_authenticated %}
        <div class="row">
            <div class="col-md-12">
                <h3>Active Proposals</h3>
                {% for proposal in user.proposal_set.all %}
                <p><a href="{% url 'proposals:detail' pk=proposal.id %}">{{ proposal }}</a>
                <br/>
                <small>{{ proposal.title }}</small>
                </p>
                {% empty %}
                <p>{% trans 'You have no proposals' %}</p>
                <p>
                    <a href="{% url 'sciapplications:index' %}">
                    {% trans 'Apply for time' %}
                    </a>
                </p>
                {% endfor %}
        {% endif %}
    </div>
</div>
{% endblock %}
{% block extra_javascript %}
{% load static bootstrap3 %}
<script src="{% static 'js/telescope_availability.js' %}"></script>
<script type="text/javascript">
$(document).ready(function(){
    var end_date = new Date();
    var start_date = new Date(end_date);
    start_date.setDate(start_date.getDate() - 3);
    start_date.setHours(0);
    start_date.setMinutes(0);
    start_date.setSeconds(0);
    var state_url = "{% url 'api:telescope_availability' %}" + "?start=" +
                     start_date.toISOString() + "&end=" + end_date.toISOString()
    $.getJSON(state_url, function(data) {
        create_telescope_availability_chart(data);
    });
});
</script>
{% endblock %}
