{% extends "base.html" %}
{% load static %}
{% block title %}Create New Request {% endblock %}
{% block extra_css %}
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.43/css/bootstrap-datetimepicker.min.css">
{% endblock %}
{% block content %}
{% verbatim %}
<div id="vueapp">
  <div class="row">
    <div class="col-md-11">
      <alert v-for="alert in alerts" :alertclass="alert.class || 'alert-danger'">{{ alert.msg }}</alert>
    </div>
  </div>
  <div id="tabs">
    <ul class="nav nav-tabs col-md-6">
      <li :class="{ active: tab === 1 }" v-on:click="tab = 1"><a><i class="fa fa-fw fa-pencil-square-o fa-2x"></i> Form</a></li>
      <li :class="{ active: tab === 2 }" v-on:click="tab = 2"><a><i class="fa fa-fw fa-code fa-2x"></i> Api View</a></li>
      <li :class="{ active: tab === 3 }" v-on:click="tab = 3"><a><i class="fa fa-fw fa-file-text-o fa-2x"></i> Drafts</a></li>
    </ul>
    <div class="col-md-5 panel-actions">
      <a class="btn btn-success" title="Submit"><i class="fa fa-check"></i> Submit</a>
      <span :class="draftId > -1 ? 'btn-group' : ''">
        <button class="btn btn-info" title="Save" v-on:click="saveDraft(draftId)">
          <i class="fa fa-save"></i> Save Draft <span v-show="draftId > -1">#{{ draftId }}</span>
        </button>
         <button v-show="draftId > -1" type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <li><a v-on:click="saveDraft(-1)">Save as new draft</a></li>
        </ul>
      </span>
    </div>
    <div class="tab-content">
      <div class="tab-pane" :class="{ active: tab === 1 }">
        <div class="row">
          <div class="col-md-11 col-sm-12 col-sm-12">
            <userrequest :errors="errors" :iuserrequest="userrequest" v-on:userrequestupdate="userrequestUpdated"></userrequest>
          </div>
          <div class="col-md-1 hidden-sm hidden-xs">
            <sidenav :userrequest="userrequest"></sidenav>
          </div>
        </div>
      </div>
      <div class="tab-pane" :class="{ active: tab === 2 }">
        <div class="row">
          <div class="col-md-12">
            <pre>{{ JSON.stringify(userrequest, null, 4) }}</pre>
          </div>
        </div>
      </div>
      <div class="tab-pane" :class="{ active: tab === 3 }">
        <div class="row">
          <div class="col-md-12">
            <drafts v-on:loaddraft="loadDraft" :tab="tab"></drafts>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/x-template" id="userrequest-template">
  <div class="row userrequestc" id="general">
    <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading panel-heading-compact">
          <div class="row">
            <div class="col-xs-4">
              <i class="fa fa-id-card-o fa-2x fa-fw"></i>
              <i title="Errors in form" class="fa fa-warning fa-2x fa-fw text-danger" v-show="!_.isEmpty(errors)"></i>
            </div>
            <div class="panel-title col-xs-4">
              General Info
            </div>
            <div class="panel-actions col-xs-4">
              <a class="btn btn-info btn-xs" v-on:click="show = !show" title="minimize/maximize">
                <i class="fa fa-fw" :class="show ? 'fa-window-minimize' : 'fa-window-maximize'"></i>
              </a>
            </div>
          </div>
        </div>
        <div class="panel-body panel-body-compact">
          <div v-for="error in errors.non_field_errors" class="alert alert-danger" role="alert">{{ error }}</div>
            <div class="row">
              <div class="col-md-6 compose-help" v-show="show">
                <dl>
                  <dt>Total Duration</dt>
                  <dd>The amount of time that will be debited from your proposal for this request.</dd>
                  <dt>Title</dt>
                  <dd>Provide a meaningful title for this observation request.</dd>
                  <dt>Proposal</dt>
                  <dd>Select the proposal for which this observation should be associated with.</dd>
                  <dt>Priority</dt>
                  <dd>Select whether this request requires rapid response. RR requests will interrupt currently running observations.</dd>
                  <dt>Ipp Value</dt>
                  <dd>Select the Inter Proposal Priority for this request.
                      <a target="_blank" href="https://lco.global/files/User_Documentation/the_new_priority_factor.pdf">
                         More information about IPP.
                      </a>
                  </dd>
                </dl>
              </div>
              <div :class="show ? 'col-md-6' : 'col-md-12'">
                <form class="form-horizontal">
                  <div class="row duration" v-show="show">
                    <span class="col-md-4"><strong>Total Duration</strong></span>
                    <span class="col-md-8">{{ $parent.durationDisplay }}</span>
                  </div>
                  <custom-field v-model="group_id" label="Title" field="title" v-on:input="update" :errors="errors.group_id">
                  </custom-field>
                  <custom-select v-model="proposal" label="Proposal" field="proposal" v-on:input="update"
                                 :errors="errors.proposal" :options="proposalOptions">
                  </custom-select>
                  <custom-select v-model="observation_type" label="Priority" field="observation_type" v-on:input="update"
                                :errors="errors.observation_type"
                                :options="[{value: 'NORMAL', text: 'Normal'},
                                           {value:'TARGET_OF_OPPORTUNITY', text: 'Target Of Opportunity'}]">
                  </custom-select>
                  <custom-field v-model="ipp_value" label="Ipp Value" field="ipp_value"
                                v-on:input="update" :errors="errors.ipp_value">
                  </custom-field>
                  <div class="collapse-inline" v-show="!show">Total Duration: <strong>{{ $parent.durationDisplay }}</strong></div>
                </form>
              </div>
            </div>
            <div v-for="(request, idx) in requests">
              <request :index="idx" :irequest="request" :iavailable_instruments="available_instruments" :parentshow="show"
                     v-on:requestupdate="requestUpdated" :errors="_.get(errors, ['requests', idx], [])">
              </request>
              <div class="request-margin"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<script type="text/x-template" id="request-template">
  <div class="row request" :id="'request' + index">
    <div class="col-md-12">
      <div class="panel panel-warning">
        <div class="panel-heading panel-heading-compact">
          <div class="row">
            <div class="col-xs-4">
              <i class="fa fa-wpexplorer fa-2x fa-fw"></i>
              <i title="Errors in form" class="fa fa-warning fa-2x fa-fw text-danger" v-show="!_.isEmpty(errors)"></i>
            </div>
            <div class="panel-title col-xs-4">
              Request #{{ index + 1}}
            </div>
            <div class="panel-actions col-xs-4">
              <a class="btn btn-danger btn-xs" v-on:click="$parent.removeRequest(index)" v-show="$parent.requests.length > 1" title="Delete">
                <i class="fa fa-trash fa-fw"></i>
              </a>
              <a class="btn btn-success btn-xs" title="Copy" v-on:click="$parent.addRequest(index)"><i class="fa fa-copy fa-fw"></i></a>
              <a class="btn btn-info btn-xs" v-on:click="show = !show" title="minimize/maximize">
                <i class="fa fa-fw" :class="show ? 'fa-window-minimize' : 'fa-window-maximize'"></i>
              </a>
            </div>
          </div>
        </div>
        <div class="panel-body panel-body-compact">
          <div v-for="error in errors.non_field_errors" class="alert alert-danger" role="alert">{{ error }}</div>
          <div class="row">
            <div class="col-md-6 compose-help" v-show="show">
              <dl>
                <dt>Data Type</dt>
                <dd>Choose <strong>Expose</strong> for imaging a target. Choose <strong>Spectra</strong> for use of a spectrograph.</dd>
                <dt>Instrument</dt>
                <dd>Please choose the instrument you would like to observe with. <a target="_blank" href="https://lco.global/observatory/instruments/">Learn more about LCO instrumentation</a>.</dd>
              </dl>
            </div>
            <div :class="show ? 'col-md-6' : 'col-md-12'">
              <form class="form-horizontal">
                 <custom-select v-model="data_type" label="Data" v-on:input="update" :errors="errors.data_type"
                                :options="[{value:'IMAGE', text: 'Image'}, {value:'SPECTRA', text:'Spectra'}]">
                </custom-select>
                <custom-select v-model="instrument_name" label="Instrument" field="instrument_name"
                               :errors="errors.instrument_name" :options="availableInstrumentOptions">
                </custom-select>
              </form>
            </div>
          </div>
          <target :itarget="target" v-on:targetupdate="targetUpdated" :datatype="data_type" :parentshow="show" :errors="_.get(errors, 'target', {})">
          </target>
          <div v-for="(molecule, idx) in molecules">
            <molecule :index="idx" :imolecule="molecule" :selectedinstrument="instrument_name" :datatype="data_type" :parentshow="show"
                      v-on:moleculeupdate="moleculeUpdated" :errors="_.get(errors, ['molecules', idx], [])">
            </molecule>
          </div>
          <div v-for="(window, idx) in windows">
            <window :index="idx" :iwindow="window" v-on:windowupdate="windowUpdated" :parentshow="show"
                    :errors="_.get(errors, ['windows', idx], [])">
            </window>
          </div>
          <constraints :iconstraints="constraints" v-on:constraintsupdate="constraintsUpdated" :parentshow="show" :errors="_.get(errors, 'constraints', {})">
          </constraints>
        </div>
      </div>
    </div>
  </div>
</script>

<script type="text/x-template" id="molecule-template">
  <div class="row target" :id="'molecule' + $parent.index + index">
    <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading panel-heading-compact">
          <div class="row">
            <div class="col-xs-4">
              <i class="fa fa-cogs fa-2x fa-fw"></i>
              <i title="Errors in form" class="fa fa-warning fa-2x fa-fw text-danger" v-show="!_.isEmpty(errors)"></i>
            </div>
            <div class="panel-title col-xs-4">
              Configuration #{{ index + 1 }}
            </div>
            <div class="panel-actions col-xs-4">
              <a class="btn btn-danger btn-xs" v-on:click="$parent.removeMolecule(index)" v-show="$parent.molecules.length > 1" title="Remove">
                <i class="fa fa-trash fa-fw"></i>
              </a>
              <a class="btn btn-success btn-xs" v-on:click="$parent.addMolecule(index)" title="Copy"><i class="fa fa-copy fa-fw"></i></a>
              <a class="btn btn-info btn-xs" v-on:click="show = !show" title="minimize/maximize">
                <i class="fa fa-fw" :class="show ? 'fa-window-minimize' : 'fa-window-maximize'"></i>
              </a>
            </div>
          </div>
        </div>
        <div class="panel-body panel-body-compact">
          <div v-for="error in errors.non_field_errors" class="alert alert-danger" role="alert">{{ error }}</div>
          <div class="row">
            <div class="col-md-6 compose-help" v-show="show">
              <dl>
                <dt>Filter/Slit</dt>
                <dd>The filter to be used if used with an imaging instrument, or slit to be used with a spectrograph.</dd>
                <dt>Binning</dt>
                <dd>The binning used to readout the camera. The recommended binning will be selected by default.</dd>
                <dt>Exposure Count</dt>
                <dd>The number of exposures to take with this configuration.</dd>
                <dt>Exposure Time</dt>
                <dd>The time in seconds for each exposure in this configuration</dd>
              </dl>
              <dl v-show="datatype === 'SPECTRA'">
                <dt>Type</dt>
                <dd>The type of exposure (allows for calibrations).</dd>
                <dt>Acquire Mode</dt>
                <dd>How the target is acquired.</dd>
              </dl>
            </div>
            <div :class="show ? 'col-md-6' : 'col-md-12'">
              <form class="form-horizontal">
                <custom-select v-model="filter" :label="datatype === 'IMAGE' ? 'Filter':'Slit'" v-on:input="update"
                               :errors="null" :options="filterOptions">
                </custom-select>
                <custom-select v-model="bin_x" label="Binning" v-on:input="binningsUpdated"
                               :errors="errors.bin_x" :options="binningsOptions">
                </custom-select>
                <custom-field v-model="exposure_count" label="Exposure Count" field="exposure_count" v-on:input="update"
                              :errors="errors.exposure_count">
                </custom-field>
                <custom-field v-model="exposure_time" label="Exposure Time" field="exposure_time" v-on:input="update"
                              :errors="errors.exposure_time">
                </custom-field>
                <div class="spectra" v-if="datatype === 'SPECTRA'">
                  <custom-select v-model="type" label="Type" v-on:input="update" :errors="errors.type"
                                 :options="[{value: 'SPECTRUM', text: 'Spectrum'},
                                            {value: 'LAMP_FLAT', text: 'Lamp Flat'},
                                            {value: 'ARC', text:'Arc'}]">
                  </custom-select>
                  <custom-select v-model="acquire_mode" label="Acquire Mode" v-on:input="update" :errors="errors.acquire_mode"
                                 :options="[{value: 'OFF', text: 'Off'},
                                            {value: 'WCS', text: 'WCS'},
                                            {value: 'BRIGHTEST', text: 'Brightest'}]">
                  </custom-select>
                  <custom-field v-show="acquire_mode === 'BRIGHTEST'" v-model="acquire_radius_arcsec" field="acquire_radius_arcsec"
                                label="Acquire Radius" v-on:input="update" :errors="errors.acquire_radius_arcsec">
                  </custom-field>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<script type="text/x-template" id="target-template">
  <div class="row target" :id="'target' + $parent.index">
    <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading panel-heading-compact">
          <div class="row">
            <div class="col-xs-4">
              <i class="fa fa-crosshairs fa-2x fa-fw"></i>
              <i title="Errors in form" class="fa fa-warning fa-2x fa-fw text-danger" v-show="!_.isEmpty(errors)"></i>
            </div>
            <div class="panel-title col-xs-4">
              Target
            </div>
            <div class="panel-actions col-xs-4">
              <a class="btn btn-info btn-xs" v-on:click="show = !show" title="minimize/maximize">
                <i class="fa fa-fw" :class="show ? 'fa-window-minimize' : 'fa-window-maximize'"></i>
              </a>
            </div>
          </div>
        </div>
        <div class="panel-body panel-body-compact">
          <div v-for="error in errors.non_field_errors" class="alert alert-danger" role="alert">{{ error }}</div>
          <div class="row">
            <div class="col-md-6 compose-help" v-show="show">
              <dl>
                <dt>Name</dt>
                <dd>The name of the target. If it is a known object, we will attempt to fill in coordinates</dd>
                <dt>Type</dt>
                <dd>Please select whether this is a <strong>sidereal</strong> or <strong>non-sidereal</strong> target.</dd>
              </dl>
              <dl v-show="type === 'SIDEREAL'">
                <dt>Right Ascension</dt>
                <dd>In decimal degrees or hours:minutes:seconds</dd>
                <dt>Declination</dt>
                <dd>In Degrees</dd>
                <dt>Proper Motion RA</dt>
                <dd>(+/-0.33 mas/year)</dd>
                <dt>Proper Motion Dec</dt>
                <dd>(+/-0.33 mas/year)</dd>
                <dt>Epoch</dt>
                <dd>Julian Years</dd>
                <dt>Parallax</dt>
                <dd>("+0.45 mas")</dd>
              </dl>
              <dl v-show="type === 'NON_SIDEREAL'">
                <dt>Scheme</dt>
                <dd>The orbital elements scheme to use with this target</dd>
                <dt>Epoch</dt>
                <dd>Modified Julian Days</dd>
                <dt>Longitude of Ascending Node</dt>
                <dd>Andle in Degrees</dd>
                <dt>Argument of Perihelion</dt>
                <dd>Angle in Degrees</dd>
                <dt>Mean Distance</dt>
                <dd>Astronomical Units</dd>
                <dt>Eccentricity</dt>
                <dd>0 to 0.99</dd>
                <dt>Mean Anomaly</dt>
                <dd>Angle in Degrees</dd>
              </dl>
            </div>
            <div :class="show ? 'col-md-6' : 'col-md-12'">
              <form class="form-horizontal">
                <custom-field v-model="name" label="Name" field="name" v-on:input="update" :errors="errors.name">
                </custom-field>
                <div class="row" v-show="lookingUP">
                    <span class="col-md-12" style="text-align: right">
                      <i class="fa fa-spinner fa-spin fa-fw"></i> Looking up coordinates...
                    </span>
                </div>
                <custom-select v-model="type" label="Type" field="type" v-on:input="update" :errors="errors.type"
                               :options="[{value: 'SIDEREAL',text: 'Sidereal'}, {value: 'NON_SIDEREAL',text:'Non-Sidereal'}]">
                </custom-select>
                <div class="sidereal" v-if="type === 'SIDEREAL'">
                  <custom-field v-model="ra" label="Right Ascension" field="ra" v-on:input="update" :errors="errors.ra">
                  </custom-field>
                  <custom-field v-model="dec" label="Declination" field="dec" v-on:input="update" :errors="errors.dec">
                  </custom-field>
                  <custom-field v-model="proper_motion_ra" label="Proper Motion: RA" field="proper_motion_ra"
                                v-on:input="update" :errors="errors.proper_motion_ra">
                  </custom-field>
                  <custom-field v-model="proper_motion_dec" label="Proper Motion: Dec" field="proper_motion_dec"
                                v-on:input="update" :errors="errors.proper_motion_dec">
                  </custom-field>
                  <custom-field v-model="epoch" label="Epoch" field="epoch" v-on:input="update" :errors="errors.epoch">
                  </custom-field>
                  <custom-field v-model="parallax" label="Parallax" field="parallax" v-on:input="update"
                                :errors="errors.parallax">
                  </custom-field>
                </div>
                <div class="non-sidereal" v-if="type === 'NON_SIDEREAL'">
                  <custom-select v-model="scheme" label="Scheme" field="scheme" v-on:input="update" :errors="errors.scheme"
                                 :options="[{value: 'MPC_MINOR_PLANET', text: 'MPC Minor Planet'},
                                            {value: 'MPC_COMET', text: 'MPC Comet'}]">
                  </custom-select>
                  <custom-field v-model="epoch" label="Epoch" field="epoch" v-on:input="update" :errors="errors.epoch">
                  </custom-field>
                  <custom-field v-model="orbinc" label="Orbital Inclination" field="orbinc" v-on:input="update"
                                :errors="errors.orbinc">
                  </custom-field>
                  <custom-field v-model="longascnode" label="Longitude of Ascending Node" field="longascnode"
                                v-on:input="update" :errors="errors.longascnode">
                  </custom-field>
                  <custom-field v-model="argofperih" label="Argument of Perihelion" field="argofperih"
                                v-on:input="update" :errors="errors.argofperih">
                  </custom-field>
                  <custom-field v-model="meandist" label="Mean Distance (AU)" field="meandist"
                                v-on:input="update" :errors="errors.meandist">
                  </custom-field>
                  <custom-field v-model="eccentricity" label="Eccentricity" field="eccentricity"
                                v-on:input="update" :errors="errors.eccentricity">
                  </custom-field>
                  <custom-field v-model="meananom" label="Mean Anomoly" field="meananom"
                                v-on:input="update" :errors="errors.meananom">
                  </custom-field>
                </div>
                <div class="spectra" v-if="datatype === 'SPECTRA'">
                  <custom-select v-model="rot_mode" label="Rotator Mode" field="rot_mode" v-on:input="update" :errors="errors.rot_mode"
                                 :options="[{value: 'SKY', text: 'Sky'}, {value: 'VFLOAT', text: 'Vertical Floating'}]">
                  </custom-select>
                  <custom-field v-model="rot_angle" label="Rotator Angle" field="rot_angle" v-on:input="update" :errors="errors.rot_angle">
                  </custom-field>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<script type="text/x-template" id="window-template">
  <div class="row window" :id="'window' + $parent.index + index">
    <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading panel-heading-compact">
          <div class="row">
            <div class="col-xs-4">
              <i class="fa fa-calendar fa-2x fa-fw"></i>
              <i title="Errors in form" class="fa fa-warning fa-2x fa-fw text-danger" v-show="!_.isEmpty(errors)"></i>
            </div>
            <div class="panel-title col-xs-4">
              Window #{{ index + 1}}
            </div>
            <div class="panel-actions col-xs-4">
              <a class="btn btn-xs btn-danger" v-on:click="$parent.removeWindow(index)" v-show="$parent.windows.length > 1" title="remove">
                <i class="fa fa-trash fa-fw"></i>
              </a>
              <a class="btn btn-xs btn-success" v-on:click="$parent.addWindow(index)" title="copy"><i class="fa fa-copy fa-fw"></i></a>
              <a class="btn btn-info btn-xs" v-on:click="show = !show" title="minimize/maximize">
                <i class="fa fa-fw" :class="show ? 'fa-window-minimize' : 'fa-window-maximize'"></i>
              </a>
            </div>
          </div>
        </div>
        <div class="panel-body panel-body-compact">
          <div v-for="error in errors.non_field_errors" class="alert alert-danger" role="alert">{{ error }}</div>
          <div class="row">
            <div class="col-md-6 compose-help" v-show="show">
              <dl>
                <dt>Start</dt>
                <dd>The lower limit of the time window.</dd>
                <dt>End</dt>
                <dd>The Upper end of the time window.</dd>
              </dl>
            </div>
            <div :class="show ? 'col-md-6' : 'col-md-12'">
              <form class="form-horizontal" >
                <custom-field v-model="start" type="datetime" label="Start" field="start" v-on:input="update" :errors="errors.start">
                </custom-field>
                <custom-field v-model="end" type="datetime" label="End" field="end" v-on:input="update"
                :errors="_.get(errors.end, 'end') || errors.end"> <!-- Validation wtf -->
                </custon-field>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<script type="text/x-template" id="constraints-template">
  <div class="row constraints" :id="'constraints' + $parent.index">
    <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading panel-heading-compact">
          <div class="row">
            <div class="col-xs-4">
              <i class="fa fa-lock fa-2x fa-fw"></i>
              <i title="Errors in form" class="fa fa-warning fa-2x fa-fw text-danger" v-show="!_.isEmpty(errors)"></i>
            </div>
            <div class="panel-title col-xs-4">
              Constraints
            </div>
            <div class="panel-actions col-xs-4">
              <a class="btn btn-info btn-xs" v-on:click="show = !show" title="minimize/maximize">
                <i class="fa fa-fw" :class="show ? 'fa-window-minimize' : 'fa-window-maximize'"></i>
              </a>
            </div>
          </div>
        </div>
        <div class="panel-body panel-body-compact">
          <div v-for="error in errors.non_field_errors" class="alert alert-danger" role="alert">{{ error }}</div>
          <div class="row">
            <div class="col-md-6 compose-help" v-show="show">
              <dl>
                <dt>Max Airmass</dt>
                <dd>The maximum airmass at which this request should be considered for the target.</dd>
                <dt>Min Lunar Distance</dt>
                <dd>The minimum distance (in degrees) the target can be to the moon before the request is no longer considered</dd>
              </dl>
            </div>
            <div :class="show ? 'col-md-6' : 'col-md-12'">
              <form class="form-horizontal">
                <custom-field v-model="max_airmass" label="Max Airmass" field="max_airmass" v-on:input="update"
                              :errors="errors.max_airmass">
                </custom-field>
                <custom-field v-model="min_lunar_distance" label="Min. Lunar Distance" field="min_lunar_distance" v-on:input="update"
                              :errors="errors.min_lunar_distance">
                </custom-field>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<script type="text/x-template" id="custom-field">
  <span>
    <div class="form-group" :class="{ 'has-error': errors }" v-show="$parent.show">
      <label :for="field" class="col-sm-4 control-label">{{ label }}</label>
      <div class="col-sm-8">
        <input :id="field" class="form-control" v-bind:value="value"
               v-on:input="update($event.target.value)" :name="field" :type="type || 'text'"/>
        <span class="help-block text-danger" v-for="error in errors">{{ error }}</span>
      </div>
    </div>
    <span class="collapse-inline" v-show="!$parent.show">{{ label }}: <strong>{{ value || '...' }}</strong></span>
  </span>
</script>

<script type="text/x-template" id="custom-select">
  <span>
    <div class="form-group" :class="{ 'has-error': errors }" v-show="$parent.show">
      <label :for="field" class="col-sm-4 control-label">{{ label }}</label>
      <div class="col-sm-8">
        <select :id="field" v-bind:value="value" v-on:change="update($event.target.value)"
                :name="field" class="form-control">
          <option v-for="option in options" :value="option.value" :selected="isSelected(option.value)">{{ option.text }}</option>
        </select>
        <span class="help-block text-danger" v-for="error in errors">{{ error }}</span>
      </div>
    </div>
    <div class="collapse-inline" v-show="!$parent.show">{{ label }}: <strong>{{ value || '...' }}</strong></div>
  </span>
</script>

<script type="text/x-template" id="sidenav-template">
  <nav class="bs-docs-sidebar">
    <ul id="sidebar" class="nav nav-stacked">
      <li><a href="#general">General Info</a></li>
      <li v-for="(request, index) in userrequest.requests">
        <a :href="'#request' + index">Request #{{ index + 1}}</a>
        <ul class="nav nav-stacked">
          <li>
            <a :href="'#target' + index">Target</a>
          </li>
          <li v-for="(molecule, molIndex) in request.molecules">
            <a :href="'#molecule' + index + molIndex"> Configutation #{{ molIndex + 1}}</a>
          </li>
          <li v-for="(window, winIndex) in request.windows">
            <a :href="'#window' + index + winIndex">Window #{{ winIndex + 1}}</a>
          </li>
          <li>
            <a :href="'#constraints' + index">Constraints</a>
          </li>
        </ul>
      </li>
    </ul>
  </nav>
</script>

<script type="text/x-template" id="drafts-template">
  <table class="table table-striped">
    <thead>
      <tr><td>Load</td><td>Title</td><td>Id</td><td>Author</td><td>Proposal</td><td>Last Modified</td><td>Delete</td></tr>
    </thead>
    <tbody>
      <tr v-for="draft in drafts">
        <td><button class="btn btn-info" v-on:click="loadDraft(draft.id)"><i class="fa fa-download"></i></button></td>
        <td>{{ draft.title }}</td>
        <td>{{ draft.id }}</td>
        <td>{{ draft.author }}</td>
        <td>{{ draft.proposal }}</td>
        <td>{{ draft.modified | formatDate  }}</td>
        <td><button class="btn btn-danger" v-on:click="deleteDraft(draft.id)"><i class="fa fa-trash"></i></button></td>
      </tr>
  </table>
</script>

<script type="text/x-template" id="alert-template">
  <div class="alert alert-dismissiable" :class="alertclass" role="alert">
    <slot></slot>
    <button class="close" data-dismiss="alert"><i class="fa fa-times"></i></button>
  </div>
</script>

{% endverbatim %}
{% endblock %}
{% block extra_javascript %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.1.8/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.43/js/bootstrap-datetimepicker.min.js"></script>
<script src="{% static 'js/request_create.js' %}"></script>
{% endblock %}
